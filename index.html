<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="Content/font-awesome.min.css" />
    <link rel="stylesheet" href="FA/css/all.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">
</head>
<body>
    <style>
        @media only screen and (min-width: 300px) {
            html {
                font-size: 0.7em;
            }
        }

        @media only screen and (min-width: 768px) {
            html {
                font-size: 0.75em;
            }
        }

        @media only screen and (min-width: 992px) {
            html {
                font-size: 0.85em;
            }
        }

        @media only screen and (min-width: 1200px) {
            html {
                font-size: 0.9em;
            }
        }
        body {
            font-family: 'Nunito', sans-serif;
            -webkit-text-size-adjust: auto;
        }

        h1 {
            font-size: 4vh;
        }

        h2 {
            font-size: 3.5vh;
        }

        h3 {
            font-size: 2.75vh;
        }

        h4 {
            font-size: 2.5vh;
        }

        a.drp {
            text-decoration: none;
        }
        /* width */
        ::-webkit-scrollbar {
            width: 5px;
        }

        /* Track */
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        /* Handle */
        ::-webkit-scrollbar-thumb {
            background: #cbcaca;
        }

            /* Handle on hover */
            ::-webkit-scrollbar-thumb:hover {
                background: #8d8c8c
            }
        /* MAGIC HAPPENS HERE */
        .scroll-bar-wrap:hover .cover-bar {
            opacity: 0;
            -webkit-transition: all .5s;
        }

        .OslerNavy {
            background-color: rgb(0,82,155);
            color: white
        }

        .OslerBlue {
            background-color: rgb(19,181,234);
            color: white
        }

        .OslerPurple {
            background-color: rgb(178,143,194);
            color: white
        }
    </style>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12 text-center">
                <h2 class="text-center" style="color:#3399FF"><strong>Antimicrobial Dosing & Renal Adjustment</strong></h2>
            </div>
        </div>


        <div class="row pt-1">
            <div class="col-3 dropdown d-none d-lg-block">
                <div class="md-form active-cyan-2 mb-3">
                    <input id="searchbox" class="form-control form-control-sm" type="search" placeholder="Search antibiotics" aria-label="Search">
                </div>
                <div style="overflow-y:auto; max-height:58vh; font-size:0.95em">
                    <div id="dropdown" class="drgsearch list-group">
                    </div>
                </div>
            </div>

            <div class="col-10 d-lg-none text-center mb-1">
                <div class="md-form active-cyan-2">
                    <input id="searchboxmbl" class="form-control form-control-sm" type="search" placeholder="Search antibiotics" aria-label="Search" list="abxlistmbl"><datalist id="abxlistmbl">
                    </datalist>
                </div>
            </div>

            <div class="col-12 col-lg-9 col-xl-8" style="overflow-y:auto; font-size:0.95em">
                <div class="card d-none" id="maincard">
                    <div class="card-body">
                        <h5 class="card-title"><span class="drug"></span>&nbsp;&nbsp;<span class="badge badge-sm form d-none"></span></h5>
                        <div class="backorder alert alert-danger d-none px-2 py-1">
                            <span class="boText"></span>
                        </div>


                        <div class="infoblock d-flex flex-row justify-content-start d-none px-2 py-1 mb-1">
                            <div class="restriction"></div>
                        </div>

                        <div class="dosingBox mb-1">
                            <p>
                                <strong class="text-primary">Normal Dosing</strong><br />
                                <span class="doselbl"></span><br />
                                <small class="text-muted"><span class="doselblsub pt-0 mt-0"></span></small>
                            </p>
                        </div>



                        <div class="autosub d-none mb-1">
                            <div class="row">
                                <div class="col-12">
                                    <a class="btn btn-success w-100 btn-sm" data-bs-toggle="collapse" href="#asb" role="button" aria-expanded="false" aria-controls="asb">
                                        <strong><i class="fas fa-check"></i>&nbsp;Eligible for Auto-substitution</strong>
                                    </a>
                                </div>
                            </div>
                            <div class="collapse" id="asb">
                                <div class="card card-body p-1" style="font-size:0.9em">
                                    <div class="row align-items-center justify-content-center asstd">
                                        <div class="col text-end px-0"><span class="aso"></span></div>
                                        <div class="col-1 text-center"><i class="far fa-arrow-alt-circle-right"></i></div>
                                        <div class="col text-start px-0"><span class="asn"></span></div>
                                    </div>
                                    <div class="exp">
                                        <hr class="mt-0 mb-1" />
                                        <div class="row align-items-center justify-content-center">

                                            <div class="col-12 text-muted text-center">
                                                <small><span class="asexp"></span></small>
                                            </div>

                                        </div>
                                    </div>
                                    <div class="assp"></div>
                                </div>
                            </div>
                        </div>

                        <div class="card ti d-none mb-1">

                            <div class="row">
                                <div class="col-12">
                                    <a class="btn btn-success w-100 btn-sm" data-bs-toggle="collapse" href="#tipnl" role="button" aria-expanded="false" aria-controls="tipnl">
                                        <strong><i class="fas fa-check"></i>&nbsp;Eligible for Therapeutic Interchange</strong>
                                    </a>
                                </div>
                            </div>
                            <div class="collapse" id="tipnl">
                                <div class="card card-body p-1" style="font-size:0.9em">
                                    <div class="row align-items-center justify-content-center">
                                        <div class="col text-end px-0"><span class="tio"></span></div>
                                        <div class="col-1 text-center"><i class="far fa-arrow-alt-circle-right"></i></div>
                                        <div class="col text-start px-0"><span class="tin"></span></div>
                                    </div>
                                    <div class="tiexp">
                                        <hr class="mt-0 mb-1" />
                                        <div class="row align-items-center justify-content-center">
                                            <div class="col-12 text-muted text-center">
                                                <small><span class="tiexptxt"></span></small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <div class="ivpo d-none mb-1">

                            <div class="row">
                                <div class="col-12">
                                    <a class="btn btn-success w-100 btn-sm" data-bs-toggle="collapse" href="#ivcol" role="button" aria-expanded="false" aria-controls="ivcol">
                                        <strong><i class="fas fa-check"></i>&nbsp;Eligible for IV to PO step-down</strong>
                                    </a>
                                </div>
                            </div>

                            <div class="collapse" id="ivcol">
                                <div class="card card-body p-1" style="font-size:0.9em">
                                    <div class="row align-items-center justify-content-center ivpotbl">
                                        <div class="col text-end px-0">
                                            <span class="ivpoTextIV"></span>
                                        </div>
                                        <div class="col-1 text-center">
                                            <i class="far fa-arrow-alt-circle-right"></i>
                                        </div>
                                        <div class="col text-start px-0">
                                            <span class="ivpoTextPO"></span>
                                        </div>
                                    </div>
                                    <hr class="mt-0 mb-1" />
                                    <div class="row">
                                        <div class="col-12 text-center">
                                                                                    </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <div class="row mt-1">
                            <div class="col-12">
                                <div class="renal d-none mb-1">

                                </div>
                            </div>
                        </div>


                    </div>
                </div>

            </div>

            <!--OLD TAB CONTENT-->
            
        </div>

        <div class="row p-0 m-0">
            <div class="col-12 text-center">

                <small class="text-muted" style="font-size:0.7em">
                    <strong>ESRD</strong>: End-stage Renal Dysfunction&nbsp;&nbsp;
                    <strong>HD</strong>: Hemodialysis&nbsp;&nbsp;
                    <strong>CRRT</strong>: Continuous Renal Replacement Therapy&nbsp;&nbsp;
                    <strong>SLED</strong>: Sustained Low Efficiency Dialysis
                </small>

            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
        <script src="scripts/moment.js"></script>
        <script src="scripts/Chart.js"></script>
        <script src="scripts/papaparse.min.js"></script>
        <script>
            $(document).ready(function () {
                getdrugs();
            });

            var data;

            $('#dropdown').on('click', 'li', function () {
                $('.abxitem').each(function () {
                    $(this).removeClass('active');
                });
                var drug = $(this).attr('id');
                $(this).addClass('active');

                loadabx(drug);

            });

            $("#searchboxmbl").on('input', function () {
                var val = this.value;
                if ($('#abxlistmbl option').filter(function () {
                    return this.value.toUpperCase() === val.toUpperCase();
                }).length) {
                    //send ajax request

                    if (this.value != '') {
                        loadabx(this.value);
                    }
                }
            });

            function loadabx(drug) {
                var med = $.grep(data, function (v) {
                    return v.DrugName == drug;
                });

                clearform();
                $('.drug').html('<strong>' + med[0].DrugName + '</strong>');
                $('.doselbl').html(med[0].Ndose);
                $('.doselblsub').html(med[0].NdoseSub);
                if (med[0].Formulary == 'Y') {
                    $('.form').html('<i class="fas fa-check"></i>&nbsp;Formulary');
                    $('.form').addClass('bg-success');
                    $('.form').removeClass('d-none');
                }
                if (med[0].Formulary == 'R') {
                    $('.form').html('<i class="fas fa-exclamation-circle"></i>&nbsp;Restricted on formulary');
                    $('.form').addClass('bg-primary');
                    $('.form').removeClass('d-none');
                }
                if (med[0].Formulary == 'N') {
                    $('.form').html('<i class="fas fa-times"></i>&nbsp;Non-formulary');
                    $('.form').addClass('bg-danger');
                    $('.form').removeClass('d-none');
                }
                if (med[0].restriction == 'Y') {
                    $('.infoblock').addClass('alert alert-info');
                    $('.infoblock').removeClass('d-none');
                    $('.restriction').html('<strong>Restriction:</strong>&nbsp;' + med[0].restrictionText);
                }
                if (med[0].autosub == 'Y') {
                    if (med[0].autosubTextOriginal == 'Tazo') {
                        $('.asstd').addClass('d-none');
                        $('.autosub').removeClass('d-none');
                        var textline = '<div class="card-body"><strong>Auto-substitutions</strong><br />';
                        $('.assp').removeClass('d-none');
                        $('.assp').html(textline + med[0].autosubTextNew + '</div>');
                    }
                    else {
                        $('.assp').html('');
                        $('.assp').addClass('d-none');
                        $('.asstd').removeClass('d-none');
                        $('.autosub').removeClass('d-none');
                        $('.aso').html(med[0].autosubTextOriginal);
                        $('.asn').html(med[0].autosubTextNew);
                        if (med[0].autosubException != '') {
                            $('.asexp').html('<strong>Exception:</strong>&nbsp;' + med[0].autosubException + '<br>');
                            //$('.exp').removeClass('d-none');
                        }
                    }
                }
                if (med[0].ti == 'Y') {
                    $('.ti').removeClass('d-none');
                    $('.tio').html(med[0].tiTextOriginal);
                    $('.tin').html(med[0].tiTextNew);
                    if (med[0].tiException != '') {
                        $('.tiexptxt').html(med[0].tiException + '<br>');
                        $('.tiexp').removeClass('d-none');
                    }
                }
                if (med[0].BO == 'Y') {
                    $('.backorder').removeClass('d-none');
                    $('.boText').html(med[0].BOText);
                }
                if (med[0].IVPO == 'Y') {
                    $('.ivpo').removeClass('d-none');
                    if (med[0].IV_IVPO == 'Cipro' || med[0].IV_IVPO == 'Septra') {
                        if (med[0].IV_IVPO == 'Cipro') {
                            $('.ivpoTextIV').html('Ciprofloxacin IV 400 mg q8h<br>Ciprofloxacin IV 400 mg q12h<br>Ciprofloxacin IV 400 mg q24h');
                            $('.ivpoTextPO').html('Ciprofloxacin PO 750 mg BID<br>Ciprofloxacin PO 500 mg BID<br>Ciprofloxacin PO 500 mg daily');
                        }
                        if (med[0].IV_IVPO == 'Septra') {
                            $('.ivpoTextIV').html('≤ 320 mg TMP/day<br>321-640 mg TMP/day<br>641-960 mg TMP/day<br>961-1280 mg TMP/day');
                            $('.ivpoTextPO').html('1 DS tab BID<br>2 DS tab BID<br>2 DS tab TID<br>2 DS tab QID');
                        }
                    }
                    else {
                        $('.ivpoTextIV').html(med[0].IV_IVPO);
                        $('.ivpoTextPO').html(med[0].PO_IVPO);
                    }
                }
                console.log(med[0].RenalDosing);
                if (med[0].RenalDosing != 'DOC') {
                    var renaltxt = '<strong class="text-primary">Renal Dosing</strong><br />' + $('#' + med[0].RenalDosing).html();
                    $('.renal').html(renaltxt);
                    $('.renal').removeClass('d-none');
                }

                $('#maincard').removeClass('d-none');

            }

            $('#searchbox').on('input', function (e) {
                var str = $('#searchbox').val();
                var list = "";

                $.each(data, function (index, r) {
                    var drug = r.DrugName.toLowerCase();
                    var txt = str.toLowerCase();
                    if (drug.match("^" + txt)) {
                        var rest = '';
                        if (r.Formulary == 'N') {
                            rest = '&nbsp;<span class="badge bg-danger rounded-pill"><strong>NF</strong></span>';
                        }
                        else if (r.restriction == 'Y') {
                            rest = '&nbsp;<span class="badge bg-danger rounded-pill"><strong>R</strong></span>';
                        }
                        list = list + '<li class="list-group-item list-group-item-action abxitem" type="button" id="' + r.DrugName + '">' + r.DrugName + rest + '</li>';
                    }
                });
                $('#dropdown').html(list);

            });

            function getdrugs() {
                $.ajax({
                    //type: "GET",
                    url: "./dbdata/abxlist.csv",
                    dataType: "text",
                    success: function (result) {
                        Papa.parse(result, {
                            header: true,
                            skipEmptyLines: true,
                            complete: function (results) {
                                var set = $.grep(results.data, function (v) {
                                    return 1 == 1;
                                });
                                data = set;
                                var list = "";
                                var mblist = "";
                                $.each(set, function (index, r) {
                                    var rest = '';
                                    if (r.Formulary == 'N') {
                                        rest = '&nbsp;<span class="badge bg-danger rounded-pill"><strong>NF</strong></span>';
                                    }
                                    else if (r.restriction == 'Y') {
                                        rest = '&nbsp;<span class="badge bg-danger rounded-pill"><strong>R</strong></span>';
                                    }
                                    mblist = mblist + '<option class="mblabx" value="' + r.DrugName + '">';
                                    list = list + '<li class="list-group-item list-group-item-action abxitem" type="button" id="' + r.DrugName + '">' + r.DrugName + rest + '</li>';
                                });
                                $('#abxlistmbl').html(mblist);
                                $('#dropdown').html(list);
                            }
                        });
                    },
                    error: function (xhr, status, error) {
                        alert("Seems like something went wrong!");
                    }
                });
            };

            function clearform() {
                $('.form').html('');
                $('.form').addClass('d-none');
                $('.form').removeClass('bg-success');
                $('.form').removeClass('bg-primary');
                $('.form').removeClass('bg-danger');
                $('.infoblock').removeClass('alert alert-info');
                $('.infoblock').addClass('d-none');
                $('.restriction').html('');
                $('.drug').html('');
                $('.backorder').addClass('d-none');
                $('.boText').html('');
                $('.autosub').addClass('d-none');
                $('.aso').html('');
                $('.asn').html('');
                $('.asexp').html('');
                //$('.exp').addClass('d-none');
                //$('.').html('');
                $('.ti').addClass('d-none');
                $('.tio').html('');
                $('.tin').html('');
                $('.tiexptxt').html('');
                //$('.tiexp').addClass('d-none');
                $('#maincard').addClass('d-none');
                $('.ivpo').addClass('d-none');
                $('.ivpoTextIV').html('');
                $('.ivpoTextPO').html('');
                $('.collapse').each(function () {
                    $(this).removeClass('show');
                });
                $('.renal').html('');
                $('.renal').addClass('d-none');
            };
        </script>
    </div>
</body>
</html>